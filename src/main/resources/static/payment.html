<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>Toss Payments 테스트</title>

    <style>
        body   { font-family: sans-serif; margin: 40px; }
        label  { display: block; margin: 8px 0 4px; }
        input,
        select,
        button { padding: 6px; font-size: 1rem; }
        input  { width: 240px; }
        select { width: 254px; }          /* input 폭과 맞춤 */
    </style>
</head>
<body>
<h1>결제 테스트 (단독 호출용)</h1>

<label for="orderId">Order&nbsp;ID</label>
<input id="orderId" placeholder="주문 ID (orders.order_id)" />

<label for="amount">Amount (원)</label>
<input id="amount" type="number" min="100" placeholder="결제 금액" />

<label for="orderName">Order&nbsp;Name</label>
<input id="orderName" placeholder="주문명 (예: 도서 3권)" />

<label for="payType">Pay&nbsp;Type</label>
<select id="payType">
    <option value="CARD">CARD</option>
    <option value="ACCOUNT">ACCOUNT</option>
</select>

<br><br>
<button id="payBtn">결제하기</button>

<script>
    /* --------------------------------------------------
     *  “결제하기” 클릭  →  우리 서버 → Toss 리다이렉트
     * -------------------------------------------------- */
    document.getElementById('payBtn').addEventListener('click', async () => {
        const orderId   = document.getElementById('orderId').value.trim();
        const payAmount = +document.getElementById('amount').value;
        const payName   = document.getElementById('orderName').value.trim();
        const payType   = document.getElementById('payType').value;   // CARD / ACCOUNT

        if (!orderId || !payAmount || !payName) {
            alert('Order ID / Amount / Order Name를 모두 입력하세요');
            return;
        }

        try {
            const res = await fetch(`/api/v1/payments/toss/${orderId}`, {
                method : 'POST',
                headers: { 'Content-Type': 'application/json' },
                body   : JSON.stringify({ payAmount, payType, payName })
            });

            if (!res.ok) {
                alert('결제 요청 실패 :\n' + await res.text());
                return;
            }

            const data = await res.json();   // PaymentResDto
            /* ---------- Toss checkout URL 선택 ---------- */
            const redirectUrl =
                data.redirectUrl           // 새 필드
                || data.nextRedirectPcUrl     // 구(舊) 필드 – PC
                || data.nextRedirectAppUrl;   // 구(舊) 필드 – 모바일

            if (redirectUrl) {
                window.location.href = redirectUrl;   // Toss 결제창으로 이동
            } else {
                alert('redirect URL 없음. 응답 확인 필요');
                console.log('[결제 응답 데이터]', data);
            }
        } catch (err) {
            console.error(err);
            alert('통신 오류 : ' + err.message);
        }
    });
</script>
</body>
</html>